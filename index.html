<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Meflo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="header">
    <div class="logo-symbol" onclick="goHome()">
      <span class="sigil">â—†</span>
      <span class="name">MEFLO</span>
    </div>
  </header>

  <main class="container" id="loginView">
    <div class="card">
      <h1>Herzlich willkommen ðŸ‘‹</h1>
      <p>Bitte melde dich bei <strong>Meflo</strong> an</p>
      <form id="loginForm">
        <input id="username" type="text" placeholder="Username" required />
        <input id="password" type="password" placeholder="Passwort" required />
        <button type="submit">Abschicken</button>
      </form>
      <p id="error" style="color:red; display:none; margin-top:1rem;">Falsche Anmeldedaten</p>
    </div>
  </main>

  <main class="home" id="homeView" style="display:none;">
    <h1 class="home-title">Willkommen bei Meflo ðŸš€</h1>
    <div class="home-image">
      <img src="assets/team.png" alt="Meflo Team">
    </div>
    <div class="tile-container">
      <div class="tile" onclick="window.location.href='powerpoint.html'">PowerPoint<br>Handout<br>Download</div>
      <div class="tile tile-secondary" onclick="window.location.href='fragezeichen.html'">Mini-Game ðŸŽ®</div>
      <div class="tile tile-success" onclick="window.location.href='bewertung.html'">Bewertung</div>
    </div>
  </main>

  <script>
    const views = ["loginView", "homeView"];
    function showView(id) {
      views.forEach(v => document.getElementById(v).style.display = "none");
      document.getElementById(id).style.display = "flex";
    }

    function goHome() {
      sessionStorage.getItem("loggedIn") === "true" ? showView("homeView") : showView("loginView");
    }

    if (sessionStorage.getItem("loggedIn") === "true") {
      showView("homeView");
    }

    const form = document.getElementById("loginForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      // âœ… WICHTIG: Permission aktiv abfragen
      if ("Notification" in window) {
        await Notification.requestPermission();
      }

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      if (username === "Admin" && password === "Affe12345") {
        sessionStorage.setItem("loggedIn", "true");
        showView("homeView");

        // âœ… Nachricht an SW senden
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ type: "LOGIN_SUCCESS" });
        }
      } else {
        document.getElementById("error").style.display = "block";
      }
    });

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").then(reg => {
        // Erzwingt Update-Check
        reg.update();
      });
    }
  </script>
</body>
</html>
